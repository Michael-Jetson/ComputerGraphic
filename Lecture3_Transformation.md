# 变换

## 基础概念

变换只有两种，一种是模型变换，一种是视图变换

![Games101_L3_4](./assets/Games101_L3_4.png)

模型的变换就是不同的对象进行变换，比如说下图中机器人的旋转，物体形变（第二个图中机器人将字母压扁）等

![Games101_L3_6](./assets/Games101_L3_6.png)

![Games101_L3_7](./assets/Games101_L3_7.png)

视图的变换就是三维到二维的投影，人生活的是三维的世界，但是眼镜（或者说相机）看到的是二维，这个过程就是投影

![Games101_L3_8](./assets/Games101_L3_8.png)

## 二维变换

二维变换是可以和矩阵联系起来的

### 缩放（Scale）变换

我们对下图中的钟表图像做一个缩放变换

![Games101_L3_10](./assets/Games101_L3_10.png)

其数学形式可表达为
$$
x^\prime=sx\\
y^\prime=sy\\
\left[
\begin{matrix}
x^\prime\\
y^\prime
\end{matrix}
\right]
=
\left[
\begin{matrix}
s&0\\
0&s\\
\end{matrix}
\right]
\left[
\begin{matrix}
x\\
y
\end{matrix}
\right]
$$
![Games101_L3_12](./assets/Games101_L3_12.png)

我们称这个对角阵为缩放矩阵

当然，也可以使用比例不等的缩放矩阵，这样不同坐标轴就可以进行不均匀的缩放，$x$轴按照$s_x$进行缩放，$y$轴按照$s_y$进行缩放

![Games101_L3_13](./assets/Games101_L3_13.png)

### 翻转变换

相对某个坐标轴进行镜像翻转，进行操作的矩阵称为**反射矩阵（Reflection Matrix）**

![Games101_L3_14](./assets/Games101_L3_14.png)

### 剪切变换（Shear）

这是一个复杂一些的变换，也叫切变，这个操作就像是沿着坐标轴去拽图像一样

如下图所示，任何一个点的纵坐标没有变化，但是横坐标会发生变化，而且移动的程度是跟其纵坐标成正比的

![Games101_L3_15](./assets/Games101_L3_15.png)

### 旋转变换（Rotate）

下图是一个二维旋转，绕着原点进行逆时针旋转，如果后面不加说明，则默认是绕原点逆时针旋转

![Games101_L3_16](./assets/Games101_L3_16.png)

旋转变换的矩阵如下

![Games101_L3_17](./assets/Games101_L3_17.png)

### 线性变换

所有的线性变换，实际上都可以当次一个矩阵

![Games101_L3_18](./assets/Games101_L3_18.png)

## 齐次坐标（Homogeneous coordinates）

有一种变换很特殊，也就是平移变换，这个变换看起来很简单，但是有一个问题，就是如何将其转化为矩阵乘法形式

![Games101_L3_22](./assets/Games101_L3_22.png)

看起来这是一个很难的问题，我们可以将其记为下图中的形式，但是这不是一种线性变换，我们也不希望平移变换是一种特殊情况或者一个特例，而是想找到一种通用的表示

![Games101_L3_23](./assets/Games101_L3_23.png)

这个问题的解决方法就是齐次坐标，齐次变换可以给出一个统一的形式来表示物体坐标，可以对于点和向量，增加一个维度来表示（下图所示），这样就可以有一个很好的性质：可以为平移等各种变换找到一个统一的表示

![Games101_L3_24](./assets/Games101_L3_24.png)

在这种齐次坐标表示下，我们对一个点进行了平移变换，然后我们就可以直接得到一个平移操作后的点，如果我们对向量进行这种操作，那么得到还是同一个向量，不会有任何改变，实现了向量的平移不变性

如果我们换一个角度思考，第三个维度也可以表示是点还是向量（下图所示），保证了向量和点在各种变换下的正确性

![Games101_L3_25](./assets/Games101_L3_25.png)

## 仿射变换（Affine Transformation）

仿射变换（Affine Transformation）是一种特殊的几何变换，它可以改变图形的尺寸、形状和位置，但在变换过程中，会保持线段的“直线性”和“平行性”。

也就是说，经过仿射变换后，所有原来的直线仍然是直线，且原来平行的线仍然是平行的。此外，仿射变换也保持了比例尺和中点的性质，即线段的中点经过变换后仍然是变换后的线段的中点，而比例分点也保持了相同的比例。

仿射变换包括以下几种基本类型的变换：

1. **平移（Translation）**：物体在空间中按照某一方向移动一定的距离，但不改变其大小和形状。
2. **缩放（Scaling）**：物体的大小按照一定的比例进行增大或缩小，可以在不同的轴向上使用不同的比例因子，但不改变其形状。
3. **旋转（Rotation）**：物体绕着某个点（在二维中为一点，在三维中为一条线）按照一定的角度进行旋转，但不改变其大小和形状。
4. **切变（Shearing）**：物体在某一方向上进行扭曲，形状发生改变，但不改变其面积（在二维）或体积（在三维）。

在计算机图形学中，这些仿射变换可以通过矩阵乘法实现，这使得变换的组合和复合变得非常容易。例如，我们可以先对一个物体进行缩放，然后进行旋转，最后进行平移，这三个操作可以通过三个矩阵的乘积来表示，从而得到一个单一的变换矩阵，用来描述这个复合的仿射变换。

最后，值得注意的是，仿射变换是一种线性变换，但并不保持角度和长度。例如，旋转保持长度但改变角度，而缩放保持角度但改变长度。

如果我们使用齐次坐标系，那么就可以统一所有的仿射变换，代价不过是多引入了一个维度

![Games101_L3_26](./assets/Games101_L3_26.png)

即有

![Games101_L3_27](./assets/Games101_L3_27.png)

## 逆变换（Inverse Transform）

将操作反过来（或者说逆向操作）就是逆变换，一般称为某变换的逆变换，数学上使用逆矩阵完成逆变换

![Games101_L3_28](./assets/Games101_L3_28.png)

当然注意一下，矩阵乘法不具有交换性，也就是说变换也不具有交换性，进行逆变换的时候也要注意顺序

![Games101_L3_34](./assets/Games101_L3_34.png)



如下图所示，变换的顺序是从$A_1$到$A_n$，如果想逆变换也要从$A_n^{-1}$到$A_1^{-1}$![Games101_L3_35](./assets/Games101_L3_35.png)

## 分解复杂变换

也可以使用拆解的方式，将一个复杂变换拆成若干基本变换，比如说下图中的绕非原点的旋转，可以将其拆解为三种变换

1. 平移中心到原点
2. 旋转
3. 平移回去

![Games101_L3_36](./assets/Games101_L3_36.png)

## 三维变换

与齐次坐标下的二维变换一致，加上额外的维度就可以得到三维齐次坐标系下的三维坐标

![Games101_L3_38](./assets/Games101_L3_38.png)

相应地，坐标变换矩阵是一个4x4的矩阵

![Games101_L3_39](./assets/Games101_L3_39.png)

# 观测变换（Viewing Transformation）

闫令琪老师说国内教材喜欢将观测变换分为视图变换（View）和投影（Projection）变换，在这里，观测变换就是视图变换+投影变换